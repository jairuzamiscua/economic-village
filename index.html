<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Economic Village - UK Inflation Story</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            background: #0a0a0a;
            color: white;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        h1 {
            text-align: center;
            background: linear-gradient(45deg, #4CAF50, #8BC34A, #CDDC39);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 3rem;
            margin-bottom: 10px;
            font-weight: 800;
        }
        
        .subtitle {
            text-align: center;
            color: #888;
            font-size: 1.2rem;
            margin-bottom: 30px;
        }
        
        /* Story Chapter Display */
        .story-header {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.1);
            text-align: center;
        }
        
        .chapter-title {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .chapter-title.fertile { color: #4CAF50; }
        .chapter-title.growth { color: #8BC34A; }
        .chapter-title.storm { color: #FF9800; }
        .chapter-title.drought { color: #F44336; }
        .chapter-title.recovery { color: #2196F3; }
        .chapter-title.restoration { color: #4CAF50; }
        
        .chapter-desc {
            font-size: 1.1rem;
            color: #ccc;
            font-style: italic;
        }
        
        /* Timeline Scrubber */
        .timeline-scrubber {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .timeline-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .current-period {
            font-size: 1.5rem;
            font-weight: bold;
            color: #4CAF50;
        }
        
        .play-controls {
            display: flex;
            gap: 10px;
        }
        
        .play-btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            padding: 10px 20px;
            border-radius: 25px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        
        .play-btn:hover,
        .play-btn.active {
            background: #4CAF50;
            border-color: #4CAF50;
            transform: translateY(-2px);
        }
        
        .scrubber-track {
            position: relative;
            height: 12px;
            background: rgba(255,255,255,0.2);
            border-radius: 6px;
            margin: 20px 0;
            cursor: pointer;
        }
        
        .scrubber-progress {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A, #CDDC39, #FF9800, #F44336, #2196F3, #4CAF50);
            border-radius: 6px;
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .scrubber-thumb {
            position: absolute;
            width: 28px;
            height: 28px;
            background: #4CAF50;
            border-radius: 50%;
            top: -8px;
            left: 0%;
            cursor: grab;
            box-shadow: 0 0 20px rgba(76, 175, 80, 0.6);
            transition: all 0.3s ease;
            border: 4px solid white;
        }
        
        .scrubber-thumb:hover {
            transform: scale(1.2);
        }
        
        .timeline-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: #888;
            margin-top: 15px;
        }
        
        /* Enhanced visual styling */
        .village-container {
            position: relative;
            height: 700px;
            border-radius: 20px;
            overflow: hidden;
            margin-bottom: 30px;
            border: 2px solid rgba(255,255,255,0.1);
            box-shadow: 0 25px 80px rgba(76, 175, 80, 0.3);
            transition: all 2s ease;
            background: linear-gradient(45deg, rgba(76, 175, 80, 0.1), rgba(139, 195, 74, 0.1));
        }
        
        /* Enhanced sky with animated elements */
        .sky {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 45%;
            transition: all 2s ease;
            background-size: 200% 200%;
            animation: sky-flow 20s ease-in-out infinite;
        }
        
        @keyframes sky-flow {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        /* Enhanced sky states with animated gradients */
        .sky-fertile { 
            background: linear-gradient(45deg, #87CEEB, #B0E0E6, #E0F6FF, #F0FFFF);
            animation-duration: 25s;
        }
        .sky-growth { 
            background: linear-gradient(45deg, #87CEEB, #ADD8E6, #F0F8FF, #E6F3FF);
            animation-duration: 20s;
        }
        .sky-storm { 
            background: linear-gradient(45deg, #696969, #808080, #A9A9A9, #778899);
            animation-duration: 8s;
        }
        .sky-drought { 
            background: linear-gradient(45deg, #8B4513, #CD853F, #DEB887, #F4A460);
            animation-duration: 5s;
        }
        .sky-recovery { 
            background: linear-gradient(45deg, #4682B4, #87CEEB, #B0C4DE, #87CEFA);
            animation-duration: 15s;
        }
        .sky-restoration { 
            background: linear-gradient(45deg, #87CEEB, #B0E0E6, #E0F6FF, #F0FFFF);
            animation-duration: 25s;
        }
        
        /* Enhanced ground with texture */
        .ground {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 55%;
            transition: all 2s ease;
            background-image: url('assets/grass-base.png');
            background-repeat: repeat;
            background-size: 32px 32px;
        }
        
        @keyframes ground-shift {
            0%, 100% { background-position: 0% 50%; }
            33% { background-position: 50% 0%; }
            66% { background-position: 100% 100%; }
        }

        .ground-fertile { 
            filter: hue-rotate(0deg) saturate(1.2) brightness(1.1);
        }
        .ground-growth { 
            filter: hue-rotate(10deg) saturate(1.4) brightness(1.2);
        }
        .ground-storm { 
            filter: hue-rotate(-30deg) saturate(0.7) brightness(0.8);
        }
        .ground-drought { 
            filter: hue-rotate(40deg) saturate(0.3) brightness(0.6) sepia(0.8);
        }
        .ground-recovery { 
            filter: hue-rotate(-10deg) saturate(0.9) brightness(0.9);
        }
        .ground-restoration { 
            filter: hue-rotate(5deg) saturate(1.1) brightness(1.0);
        }

        /* Enhanced weather elements */
        .sun {
            position: absolute;
            top: 10%;
            right: 10%;
            font-size: 5rem;
            transition: all 2s ease;
            filter: drop-shadow(0 0 30px rgba(255, 215, 0, 0.8));
            animation: sun-glow 4s ease-in-out infinite;
        }
        
        @keyframes sun-glow {
            0%, 100% { filter: drop-shadow(0 0 30px rgba(255, 215, 0, 0.8)); }
            50% { filter: drop-shadow(0 0 50px rgba(255, 215, 0, 1)); }
        }
        
        .sun-storm { opacity: 0.3; }
        .sun-drought { opacity: 0.5; color: #FF6B35; }
        .sun-recovery { opacity: 0.7; }
        
        /* Village Elements with proper positioning */
        .village-elements {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 100%;
            pointer-events: none;
        }
        
        /* Market Stalls - properly positioned */
        .stall {
            position: absolute;
            bottom: 20%;
            transition: all 2s ease;
            cursor: pointer;
            pointer-events: all;
            filter: drop-shadow(0 5px 15px rgba(0,0,0,0.3));
            z-index: 10;
            font-size: 2.5rem;
        }
        
        .stall-1 { left: 15%; }
        .stall-2 { left: 35%; }
        .stall-3 { left: 55%; }
        .stall-4 { left: 75%; }
        
        .stall:hover {
            transform: scale(1.2) translateY(-5px);
            filter: drop-shadow(0 10px 25px rgba(0,0,0,0.4));
            z-index: 100;
        }
        
        .stall-fertile { opacity: 1; transform: scale(1); }
        .stall-growth { opacity: 1; transform: scale(1.1); animation: market-buzz 3s ease-in-out infinite; }
        .stall-storm { opacity: 0.7; transform: scale(0.9); }
        .stall-drought { opacity: 0.3; transform: scale(0.6); }
        .stall-recovery { opacity: 0.6; transform: scale(0.8); }
        .stall-restoration { opacity: 1; transform: scale(1); }
        
        @keyframes market-buzz {
            0%, 100% { transform: scale(1.1); }
            50% { transform: scale(1.15); }
        }
        
        /* Houses - properly positioned and spaced */
        .house {
            position: absolute;
            bottom: 35%;
            font-size: 2.5rem;
            transition: all 2s ease;
            filter: drop-shadow(0 3px 10px rgba(0,0,0,0.2));
            cursor: pointer;
            z-index: 5;
            pointer-events: all;
        }
        
        .house-1 { left: 5%; }
        .house-2 { left: 22%; }
        .house-3 { left: 65%; }
        .house-4 { left: 82%; }
        
        .house:hover {
            transform: scale(1.1) translateY(-3px);
            filter: drop-shadow(0 8px 20px rgba(0,0,0,0.3));
        }
        
        .house-fertile { opacity: 1; filter: brightness(1.2) drop-shadow(0 3px 10px rgba(0,0,0,0.2)); }
        .house-growth { opacity: 1; filter: brightness(1.3) drop-shadow(0 3px 10px rgba(0,0,0,0.2)); }
        .house-storm { opacity: 0.8; filter: brightness(0.9) drop-shadow(0 3px 10px rgba(0,0,0,0.2)); }
        .house-drought { opacity: 0.4; filter: brightness(0.6) drop-shadow(0 3px 10px rgba(0,0,0,0.2)); }
        .house-recovery { opacity: 0.7; filter: brightness(0.9) drop-shadow(0 3px 10px rgba(0,0,0,0.2)); }
        .house-restoration { opacity: 1; filter: brightness(1.2) drop-shadow(0 3px 10px rgba(0,0,0,0.2)); }
        
        /* Price Boards - positioned relative to stalls */
        .price-board {
            position: absolute;
            bottom: 30%;
            background: linear-gradient(135deg, rgba(139, 69, 19, 0.95), rgba(160, 82, 45, 0.9));
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: bold;
            border: 2px solid #8B4513;
            transition: all 2s ease;
            pointer-events: all;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            z-index: 15;
            min-width: 80px;
            text-align: center;
        }
        
        .price-board-1 { left: 12%; }
        .price-board-2 { left: 32%; }
        .price-board-3 { left: 52%; }
        .price-board-4 { left: 72%; }
        
        .price-board:hover {
            transform: scale(1.15) translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.4);
            background: linear-gradient(135deg, rgba(139, 69, 19, 1), rgba(160, 82, 45, 0.95));
        }
        
        /* People/Villagers - properly positioned */
        .villager {
            position: absolute;
            bottom: 10%;
            font-size: 1.8rem;
            transition: all 2s ease;
            animation: gentle-walk 4s ease-in-out infinite;
            cursor: pointer;
            filter: drop-shadow(0 2px 5px rgba(0,0,0,0.2));
            z-index: 8;
            pointer-events: all;
        }
        
        .villager-1 { left: 18%; animation-delay: 0s; }
        .villager-2 { left: 38%; animation-delay: 1s; }
        .villager-3 { left: 58%; animation-delay: 2s; }
        .villager-4 { left: 78%; animation-delay: 3s; }
        
        @keyframes gentle-walk {
            0%, 100% { transform: translateX(0px); }
            50% { transform: translateX(10px); }
        }
        
        .villager:hover {
            animation-play-state: paused;
            transform: scale(1.3) translateY(-3px);
            filter: drop-shadow(0 5px 12px rgba(0,0,0,0.3));
        }
        
        .villager-fertile { opacity: 1; }
        .villager-growth { opacity: 1; animation-duration: 3s; }
        .villager-storm { opacity: 0.6; }
        .villager-drought { opacity: 0.2; animation: villager-leave 6s ease-out infinite; }
        .villager-recovery { opacity: 0.7; }
        .villager-restoration { opacity: 1; }
        
        @keyframes villager-leave {
            0%, 70% { transform: translateX(0px); opacity: 0.2; }
            100% { transform: translateX(100px); opacity: 0; }
        }
        
        /* Trees and vegetation - properly positioned */
        .tree {
            position: absolute;
            bottom: 15%;
            transition: all 2s ease;
            cursor: pointer;
            animation: tree-sway 6s ease-in-out infinite;
            filter: drop-shadow(0 3px 8px rgba(0,0,0,0.2));
            z-index: 3;
            pointer-events: all;
        }
        
        .tree-1 { left: 2%; font-size: 3rem; }
        .tree-2 { left: 28%; font-size: 2.5rem; }
        .tree-3 { left: 45%; font-size: 3.5rem; }
        .tree-4 { left: 62%; font-size: 2.8rem; }
        .tree-5 { left: 88%; font-size: 3.2rem; }
        
        .tree:hover {
            animation-play-state: paused;
            transform: scale(1.1) translateY(-3px);
        }
        
        @keyframes tree-sway {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(1deg); }
            75% { transform: rotate(-1deg); }
        }
        
        .tree-fertile { opacity: 1; color: #228B22; transform: scale(1); }
        .tree-growth { opacity: 1; color: #32CD32; transform: scale(1.1); }
        .tree-storm { opacity: 0.7; color: #6B8E23; transform: scale(0.9); }
        .tree-drought { opacity: 0.2; color: #8B4513; transform: scale(0.4); }
        .tree-recovery { opacity: 0.6; color: #9ACD32; transform: scale(0.7); }
        .tree-restoration { opacity: 1; color: #228B22; transform: scale(1); }
        
        /* Enhanced tooltip with economic insights */
        .tooltip {
            position: fixed;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.95), rgba(20, 20, 20, 0.95));
            color: white;
            padding: 15px 20px;
            border-radius: 12px;
            font-size: 0.9rem;
            max-width: 320px;
            z-index: 10000;
            opacity: 0;
            transition: all 0.3s ease;
            pointer-events: none;
            border: 2px solid #4CAF50;
            box-shadow: 0 10px 30px rgba(0,0,0,0.4);
            backdrop-filter: blur(10px);
        }
        
        .tooltip.show { 
            opacity: 1; 
            transform: translateY(-5px);
        }
        
        .tooltip-title {
            font-weight: bold;
            color: #4CAF50;
            margin-bottom: 8px;
            font-size: 1rem;
        }
        
        .tooltip-economic {
            color: #FFD700;
            font-style: italic;
            margin-top: 8px;
            font-size: 0.85rem;
            border-top: 1px solid rgba(255,255,255,0.2);
            padding-top: 8px;
        }
        
        /* For Sale and Closed Signs */
        .for-sale-sign, .closed-sign {
            position: absolute;
            background: #F44336;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: bold;
            transform: rotate(-15deg);
            opacity: 0;
            transition: opacity 2s ease;
            z-index: 20;
        }
        
        .for-sale-sign.active, .closed-sign.active {
            opacity: 1;
            animation: sign-flutter 3s ease-in-out infinite;
        }
        
        .for-sale-1 { bottom: 45%; left: 7%; }
        .for-sale-2 { bottom: 45%; left: 24%; }
        .closed-1 { bottom: 25%; left: 17%; }
        .closed-2 { bottom: 25%; left: 37%; }
        
        @keyframes sign-flutter {
            0%, 100% { transform: rotate(-15deg); }
            50% { transform: rotate(-10deg); }
        }
        
        /* Rain effects */
        .rain {
            position: absolute;
            width: 2px;
            height: 25px;
            background: linear-gradient(180deg, rgba(173,216,230,0.9), rgba(173,216,230,0.3), transparent);
            opacity: 0;
            animation: enhanced-rainfall 2s linear infinite;
            border-radius: 2px;
        }
        
        .rain.active {
            opacity: 1;
        }
        
        @keyframes enhanced-rainfall {
            0% { 
                top: 5%; 
                opacity: 0;
                transform: translateX(0px);
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 0.8;
                transform: translateX(5px);
            }
            100% { 
                top: 65%; 
                opacity: 0;
                transform: translateX(10px);
            }
        }
        
        /* Current state display */
        .state-display {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .state-card {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.1);
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .state-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(76, 175, 80, 0.2);
        }
        
        .inflation-display {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .inflation-fertile { color: #4CAF50; }
        .inflation-growth { color: #8BC34A; }
        .inflation-storm { color: #FF9800; }
        .inflation-drought { color: #F44336; }
        .inflation-recovery { color: #2196F3; }
        .inflation-restoration { color: #4CAF50; }
        
        /* Responsive design */
        @media (max-width: 768px) {
            .state-display {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .village-container {
                height: 500px;
            }
            
            .stall, .house, .tree {
                font-size: 1.5rem;
            }
            
            .sun {
                font-size: 3rem;
            }
            
            .tooltip {
                max-width: 250px;
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🏘️ The Economic Village</h1>
        <p class="subtitle">Experience the human story of UK inflation through a thriving community</p>
        
        <!-- Story Chapter Header -->
        <div class="story-header">
            <div class="chapter-title fertile" id="chapterTitle">Chapter 1: Fertile Fields</div>
            <div class="chapter-desc" id="chapterDesc">A peaceful farming community enjoys stable prices and prosperity</div>
        </div>
        
        <!-- Timeline Scrubber -->
        <div class="timeline-scrubber">
            <div class="timeline-header">
                <div class="current-period" id="currentPeriod">January 2020</div>
                <div class="play-controls">
                    <button class="play-btn" onclick="playStory()">📖 Tell Story</button>
                    <button class="play-btn" onclick="pauseStory()">⏸️ Pause</button>
                    <button class="play-btn" onclick="resetStory()">🔄 Restart</button>
                </div>
            </div>
            
            <div class="scrubber-track" onclick="scrubToPosition(event)">
                <div class="scrubber-progress" id="scrubberProgress"></div>
                <div class="scrubber-thumb" id="scrubberThumb"></div>
            </div>
            
            <div class="timeline-labels">
                <span>2020<br><small>🌱 Fertile</small></span>
                <span>2021<br><small>🌿 Growth</small></span>
                <span>2022<br><small>🌵 Drought</small></span>
                <span>2023<br><small>🌦️ Recovery</small></span>
                <span>2024<br><small>🌻 Restoration</small></span>
            </div>
        </div>
        
        <!-- Current State Display -->
        <div class="state-display">
            <div class="state-card">
                <div class="inflation-display inflation-fertile" id="inflationValue">0.8%</div>
                <div style="color: #888; font-size: 0.9rem;">Inflation Rate</div>
            </div>
            <div class="state-card">
                <div style="font-size: 1.5rem; margin-bottom: 10px;" id="communityMood">😊</div>
                <div style="color: #888; font-size: 0.9rem;" id="moodDesc">Community Thriving</div>
            </div>
            <div class="state-card">
                <div style="font-size: 1.5rem; margin-bottom: 10px;" id="economicHealth">💚</div>
                <div style="color: #888; font-size: 0.9rem;" id="healthDesc">Economy Healthy</div>
            </div>
        </div>
        
        <!-- Main Village Scene -->
        <div class="village-container" id="villageContainer">
            <!-- Sky -->
            <div class="sky sky-fertile" id="sky">
                <!-- Rain -->
                <div class="rain" style="left: 20%; animation-delay: 0s;"></div>
                <div class="rain" style="left: 25%; animation-delay: 0.3s;"></div>
                <div class="rain" style="left: 30%; animation-delay: 0.6s;"></div>
                <div class="rain" style="left: 45%; animation-delay: 0.9s;"></div>
                <div class="rain" style="left: 50%; animation-delay: 1.2s;"></div>
                <div class="rain" style="left: 55%; animation-delay: 1.5s;"></div>
            </div>
            
            <!-- Sun -->
            <div class="sun sun-fertile" id="sun">☀️</div>
            
            <!-- Ground -->
            <div class="ground ground-fertile" id="ground"></div>
            
            <!-- Village Elements -->
            <div class="village-elements">
                <!-- Houses with economic insights -->
                <div class="house house-fertile house-1" 
                     data-title="Family Home - Mortgage Affordable" 
                     data-content="When inflation is low, mortgage payments are manageable relative to income. Families can invest in home improvements and feel secure about their housing costs."
                     data-economic="💡 Economic insight: Low inflation = stable housing costs = confident consumer spending">🏠</div>
                
                <div class="house house-fertile house-2" 
                     data-title="Growing Family Investment" 
                     data-content="Stable prices allow families to plan for the future. They can budget for children's education and save for home expansions."
                     data-economic="📊 Consumer behavior: Price stability encourages long-term planning and investment">🏡</div>
                
                <div class="house house-fertile house-3" 
                     data-title="Neighborhood Prosperity" 
                     data-content="When inflation is controlled, property values grow steadily. Homeowners feel wealthier and spend more on local businesses."
                     data-economic="🏗️ Wealth effect: Stable asset prices boost consumer confidence and spending">🏠</div>
                
                <div class="house house-fertile house-4" 
                     data-title="Community Investment" 
                     data-content="Low inflation periods see increased community development. People invest in their neighborhoods when they trust economic stability."
                     data-economic="🌱 Multiplier effect: Housing confidence spreads to all economic sectors">🏡</div>
                
                <!-- For Sale Signs (hidden initially) -->
                <div class="for-sale-sign for-sale-1">FOR SALE</div>
                <div class="for-sale-sign for-sale-2">FOR SALE</div>
                
                <!-- Trees with environmental economics -->
                <div class="tree tree-fertile tree-1" 
                     data-title="Economic Growth Environment" 
                     data-content="Healthy trees represent sustainable economic growth. Like nature, economies need stable conditions to flourish long-term."
                     data-economic="🌿 Growth theory: Sustainable inflation rates (2%) mirror natural growth patterns">🌳</div>
                
                <div class="tree tree-fertile tree-2" 
                     data-title="Investment in Future" 
                     data-content="Trees take years to mature, like business investments. Stable inflation encourages long-term thinking and patient capital."
                     data-economic="⏳ Time preference: Low inflation reduces uncertainty, encouraging long-term investments">🌲</div>
                
                <div class="tree tree-fertile tree-3" 
                     data-title="Root System Stability" 
                     data-content="Strong economic foundations, like tree roots, require consistent conditions. Inflation volatility damages these deep structures."
                     data-economic="🏛️ Institutional strength: Predictable inflation builds trust in economic institutions">🌳</div>
                
                <div class="tree tree-fertile tree-4" 
                     data-title="Ecosystem Balance" 
                     data-content="Economic ecosystems, like forests, need balance. Too little inflation causes stagnation, too much causes instability."
                     data-economic="⚖️ Optimal policy: Central banks target 2% inflation to balance growth and stability">🌲</div>
                
                <div class="tree tree-fertile tree-5" 
                     data-title="Natural Economic Cycles" 
                     data-content="Healthy economies have natural cycles of growth and rest, like seasonal changes that support sustainable development."
                     data-economic="🔄 Business cycles: Moderate inflation signals healthy economic circulation">🌳</div>
                
                <!-- Market Stalls with detailed economic analysis -->
                <div class="stall stall-fertile stall-1" 
                     data-title="Fresh Produce Market - High Demand" 
                     data-content="When inflation is stable, customers shop regularly and vendors can predict costs. Fresh produce moves quickly and profits are steady."
                     data-economic="📈 Supply & Demand: Stable prices = predictable consumer behavior = efficient markets">🛒</div>
                
                <div class="stall stall-fertile stall-2" 
                     data-title="Local Apple Stand - Thriving Business" 
                     data-content="The apple vendor can plan harvest to market with confidence. Steady prices mean families include fresh fruit in their regular shopping."
                     data-economic="🍎 Price elasticity: Essential goods maintain demand, but income effects still matter">🍎</div>
                
                <div class="stall stall-fertile stall-3" 
                     data-title="Farm-to-Market Success" 
                     data-content="Local farmers invest in quality when they can predict selling prices. Stable inflation supports local food systems and community connections."
                     data-economic="🚜 Agricultural economics: Price certainty encourages production investment and quality">🥕</div>
                
                <div class="stall stall-fertile stall-4" 
                     data-title="Grain & Bread Partnership" 
                     data-content="Bakers can offer consistent prices when grain costs are predictable. This stability supports both businesses and customer loyalty."
                     data-economic="🌾 Value chain: Stable input costs enable stable output prices throughout supply chain">🌾</div>
                
                <!-- Price Boards with economic theory -->
                <div class="price-board price-board-1" id="priceBoard1" 
                     data-title="Bread Pricing - Stable & Affordable" 
                     data-content="At £3, bread represents about 15 minutes of minimum wage work. This ratio stays stable during low inflation periods."
                     data-economic="⏰ Real wages: When nominal wages grow with inflation, purchasing power remains constant">Bread £3</div>
                
                <div class="price-board price-board-2" id="priceBoard2" 
                     data-title="Milk Pricing - Family Essential" 
                     data-content="Milk prices reflect both local dairy costs and global commodity markets. Stable inflation keeps these essentials affordable."
                     data-economic="🥛 Necessities: Food inflation disproportionately affects lower-income households">Milk £1.90</div>
                
                <div class="price-board price-board-3" id="priceBoard3" 
                     data-title="Egg Pricing - Protein Economics" 
                     data-content="Eggs are a key protein source for families. At £4, they remain accessible while supporting local farmers' livelihoods."
                     data-economic="🥚 Nutrition economics: Affordable protein sources are crucial for public health and productivity">Eggs £4</div>
                
                <div class="price-board price-board-4" id="priceBoard4" 
                     data-title="Apple Pricing - Health Investment" 
                     data-content="Fresh fruit at £3 represents families' ability to invest in health. Stable prices support both nutrition and farmer income."
                     data-economic="🍏 Health economics: Affordable fresh produce reduces long-term healthcare costs">Apples £3</div>
                
                <!-- Closed Signs (hidden initially) -->
                <div class="closed-sign closed-1">CLOSED</div>
                <div class="closed-sign closed-2">CLOSED</div>
                
                <!-- Villagers with behavioral economics -->
                <div class="villager villager-fertile villager-1" 
                     data-title="Confident Family Shoppers" 
                     data-content="This family shops weekly without checking every price. Stable inflation builds consumer confidence and routine spending patterns."
                     data-economic="🛍️ Consumer psychology: Price stability reduces decision fatigue and supports regular consumption">🚶‍♀️</div>
                
                <div class="villager villager-fertile villager-2" 
                     data-title="Multi-Generational Prosperity" 
                     data-content="Three generations shop together when inflation is stable. Grandparents can help with costs and families can plan together."
                     data-economic="👨‍👩‍👧 Intergenerational wealth: Stable currency preserves savings and enables family financial support">👨‍👩‍👧</div>
                
                <div class="villager villager-fertile villager-3" 
                     data-title="Children's Economic Security" 
                     data-content="Children can enjoy treats and toys when family budgets aren't stretched by inflation. This supports healthy development."
                     data-economic="👶 Development economics: Economic stability in childhood correlates with better life outcomes">👶</div>
                
                <div class="villager villager-fertile villager-4" 
                     data-title="Community Member Investment" 
                     data-content="People invest time in community when they're not worried about basic costs. Stable inflation supports social capital."
                     data-economic="🤝 Social capital: Economic stability frees mental resources for community engagement">🚶‍♂️</div>
            </div>
        </div>
        
        <!-- Tooltip -->
        <div class="tooltip" id="tooltip"></div>
    </div>
    
    <script>
        // Enhanced story data with detailed community narrative
        const villageStory = [
            // Fertile Fields (0-2%)
            { 
                date: "2020-01", rate: 0.8, stage: "fertile", chapter: "Chapter 1: Fertile Fields",
                desc: "A peaceful farming community enjoys stable prices and prosperity",
                mood: "😊", moodDesc: "Community Thriving", health: "💚", healthDesc: "Economy Healthy",
                prices: ["Bread £3", "Milk £1.90", "Eggs £4", "Apples £3"],
                narrative: "The village prospers with stable inflation. Families shop confidently, businesses thrive, and the future looks bright."
            },
            { 
                date: "2020-06", rate: 0.5, stage: "fertile", chapter: "Chapter 1: Fertile Fields",
                desc: "Despite global uncertainty, the community remains stable and hopeful",
                mood: "😊", moodDesc: "Cautiously Optimistic", health: "💚", healthDesc: "Resilient Economy",
                prices: ["Bread £3", "Milk £1.90", "Eggs £4", "Apples £3"],
                narrative: "Even during the pandemic, careful economic management keeps prices stable and the community together."
            },
            
            // Growth Period (2-4%)
            { 
                date: "2021-03", rate: 1.9, stage: "growth", chapter: "Chapter 2: Growing Prosperity",
                desc: "The community expands as new opportunities emerge and optimism returns",
                mood: "😄", moodDesc: "Optimistic Growth", health: "💚", healthDesc: "Expanding Economy",
                prices: ["Bread £3.20", "Milk £2.10", "Eggs £4.20", "Apples £3.20"],
                narrative: "Recovery brings new businesses and jobs. Slight price increases are manageable as incomes grow."
            },
            { 
                date: "2021-06", rate: 3.2, stage: "growth", chapter: "Chapter 2: Growing Prosperity", 
                desc: "Bustling markets and expanding businesses show economic vitality",
                mood: "😄", moodDesc: "Confident Expansion", health: "💛", healthDesc: "Warming Economy",
                prices: ["Bread £3.50", "Milk £2.25", "Eggs £4.45", "Apples £3.50"],
                narrative: "The village buzzes with activity. New stalls open, but some residents start noticing higher prices."
            },
            
            // Storm Clouds (5-7%)
            { 
                date: "2021-09", rate: 4.1, stage: "storm", chapter: "Chapter 3: Storm Clouds Gather",
                desc: "Residents begin to feel economic pressure as prices rise faster than wages",
                mood: "😐", moodDesc: "Growing Concern", health: "🧡", healthDesc: "Economic Stress",
                prices: ["Bread £3.80", "Milk £2.50", "Eggs £4.80", "Apples £3.80"],
                narrative: "Worried faces appear at market stalls. Families start comparing prices and cutting back on luxuries."
            },
            { 
                date: "2021-12", rate: 5.4, stage: "storm", chapter: "Chapter 3: Storm Clouds Gather",
                desc: "The first shop closures appear as economic pressure builds throughout the community",
                mood: "😟", moodDesc: "Visible Worry", health: "🧡", healthDesc: "Economic Strain",
                prices: ["Bread £4.10", "Milk £2.80", "Eggs £5.20", "Apples £4.10"],
                narrative: "Some villagers shop less frequently. The first 'CLOSED' sign appears on a struggling stall."
            },
            
            // Economic Drought (8-11%)
            { 
                date: "2022-03", rate: 7.0, stage: "drought", chapter: "Chapter 4: The Great Economic Drought",
                desc: "Crisis deepens as essential goods become unaffordable for many families",
                mood: "😰", moodDesc: "Community Stress", health: "❤️", healthDesc: "Economy Struggling",
                prices: ["Bread £4.50", "Milk £3.20", "Eggs £5.80", "Apples £4.50"],
                narrative: "Price boards show constant changes. Several families can no longer afford their weekly shopping."
            },
            { 
                date: "2022-07", rate: 11.1, stage: "drought", chapter: "Chapter 4: The Great Economic Drought",
                desc: "Peak crisis - the village becomes a shadow of its former self",
                mood: "😢", moodDesc: "Crisis Mode", health: "💔", healthDesc: "Economic Emergency",
                prices: ["Bread £5.20", "Milk £3.80", "Eggs £6.50", "Apples £5.20"],
                narrative: "Half the market stalls are abandoned. 'FOR SALE' signs appear on houses as families are forced to leave."
            },
            { 
                date: "2022-12", rate: 8.8, stage: "drought", chapter: "Chapter 4: The Great Economic Drought",
                desc: "The community endures its darkest economic period in living memory",
                mood: "😔", moodDesc: "Enduring Hardship", health: "💔", healthDesc: "Deep Recession",
                prices: ["Bread £4.80", "Milk £3.50", "Eggs £6.20", "Apples £4.80"],
                narrative: "Only the strongest businesses survive. Neighbors help neighbors as the community pulls together."
            },
            
            // Recovery (4-5%)
            { 
                date: "2023-03", rate: 6.8, stage: "recovery", chapter: "Chapter 5: Recovery Rains",
                desc: "First signs of hope as economic policies begin to show positive effects",
                mood: "🙂", moodDesc: "Cautious Hope", health: "💙", healthDesc: "Signs of Recovery",
                prices: ["Bread £4.50", "Milk £3.20", "Eggs £5.80", "Apples £4.50"],
                narrative: "The first rain in months brings new hope. A few families cautiously return to shop at the remaining stalls."
            },
            { 
                date: "2023-06", rate: 5.2, stage: "recovery", chapter: "Chapter 5: Recovery Rains",
                desc: "Green shoots of recovery appear as prices stabilize and confidence slowly returns",
                mood: "🙂", moodDesc: "Growing Optimism", health: "💙", healthDesc: "Steady Recovery",
                prices: ["Bread £4.20", "Milk £2.90", "Eggs £5.40", "Apples £4.20"],
                narrative: "New green shoots appear where the land was barren. Some closed stalls begin to reopen with limited stock."
            },
            { 
                date: "2023-12", rate: 3.8, stage: "recovery", chapter: "Chapter 5: Recovery Rains",
                desc: "The community rebuilds with hard-earned wisdom about economic resilience",
                mood: "😊", moodDesc: "Renewed Confidence", health: "💚", healthDesc: "Healing Economy",
                prices: ["Bread £3.80", "Milk £2.60", "Eggs £4.80", "Apples £3.80"],
                narrative: "More families return to the village. The market is smaller but stronger, built on sustainable foundations."
            },
            
            // Restoration (2%)
            { 
                date: "2024-06", rate: 2.8, stage: "restoration", chapter: "Chapter 6: New Foundations",
                desc: "A wiser, more resilient community emerges from the economic trials",
                mood: "😊", moodDesc: "Stable Prosperity", health: "💚", healthDesc: "Sustainable Growth",
                prices: ["Bread £3.40", "Milk £2.20", "Eggs £4.40", "Apples £3.40"],
                narrative: "The village has learned valuable lessons. Prices are higher than before, but incomes have adjusted and stability has returned."
            },
            { 
                date: "2024-11", rate: 2.2, stage: "restoration", chapter: "Chapter 6: New Foundations",
                desc: "The economic village thrives once more, stronger and wiser than before",
                mood: "😊", moodDesc: "Thriving Community", health: "💚", healthDesc: "Healthy Balance",
                prices: ["Bread £3.20", "Milk £2.05", "Eggs £4.20", "Apples £3.20"],
                narrative: "A new generation of children plays in the restored fields, while their parents build a more resilient economic future."
            }
        ];
        
        let currentIndex = villageStory.length - 1;
        let isPlaying = false;
        let playInterval;
        
        // Initialize village
        updateVillage(currentIndex);
        
        function updateVillage(index) {
            const data = villageStory[index];
            currentIndex = index;
            
            // Update timeline
            const progress = (index / (villageStory.length - 1)) * 100;
            document.getElementById('scrubberProgress').style.width = progress + '%';
            document.getElementById('scrubberThumb').style.left = progress + '%';
            
            // Update story header
            const date = new Date(data.date + '-01');
            const monthYear = date.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
            document.getElementById('currentPeriod').textContent = monthYear;
            document.getElementById('chapterTitle').textContent = data.chapter;
            document.getElementById('chapterTitle').className = 'chapter-title ' + data.stage;
            document.getElementById('chapterDesc').textContent = data.desc;
            
            // Update state cards
            document.getElementById('inflationValue').textContent = data.rate + '%';
            document.getElementById('inflationValue').className = 'inflation-display inflation-' + data.stage;
            document.getElementById('communityMood').textContent = data.mood;
            document.getElementById('moodDesc').textContent = data.moodDesc;
            document.getElementById('economicHealth').textContent = data.health;
            document.getElementById('healthDesc').textContent = data.healthDesc;
            
            // Update price boards
            data.prices.forEach((price, i) => {
                const priceBoard = document.getElementById(`priceBoard${i + 1}`);
                if (priceBoard) {
                    priceBoard.innerHTML = price;
                }
            });
            
            // Update village scene
            updateVillageScene(data);
            
            // Update dynamic tooltip content based on economic stage
            updateTooltipContent(data.stage);
        }
        
        function updateVillageScene(data) {
            const stage = data.stage;
            
            // Update sky and ground
            document.getElementById('sky').className = 'sky sky-' + stage;
            document.getElementById('ground').className = 'ground ground-' + stage;
            document.getElementById('sun').className = 'sun sun-' + stage;
            
            // Update rain
            const raindrops = document.querySelectorAll('.rain');
            raindrops.forEach(rain => {
                if (stage === 'recovery') {
                    rain.classList.add('active');
                } else {
                    rain.classList.remove('active');
                }
            });
            
            // Update all village elements
            const stalls = document.querySelectorAll('.stall');
            const houses = document.querySelectorAll('.house');
            const trees = document.querySelectorAll('.tree');
            const villagers = document.querySelectorAll('.villager');
            const forSaleSigns = document.querySelectorAll('.for-sale-sign');
            const closedSigns = document.querySelectorAll('.closed-sign');
            
            // Update stalls
            stalls.forEach(stall => {
                const stallClass = stall.classList[1]; // preserve original class
                stall.className = 'stall stall-' + stage + ' ' + stallClass;
            });
            
            // Update houses
            houses.forEach(house => {
                const houseClass = house.classList[1]; // preserve original class
                house.className = 'house house-' + stage + ' ' + houseClass;
            });
            
            // Update trees
            trees.forEach(tree => {
                const treeClass = tree.classList[1]; // preserve original class
                tree.className = 'tree tree-' + stage + ' ' + treeClass;
            });
            
            // Update villagers
            villagers.forEach(villager => {
                const villagerClass = villager.classList[1]; // preserve original class
                villager.className = 'villager villager-' + stage + ' ' + villagerClass;
            });
            
            // Show/hide crisis signs
            forSaleSigns.forEach(sign => {
                if (stage === 'drought') {
                    sign.classList.add('active');
                } else {
                    sign.classList.remove('active');
                }
            });
            
            closedSigns.forEach(sign => {
                if (stage === 'drought' || stage === 'storm') {
                    sign.classList.add('active');
                } else {
                    sign.classList.remove('active');
                }
            });
        }
        
        function playStory() {
            if (isPlaying) return;
            
            isPlaying = true;
            const playBtn = document.querySelector('.play-btn');
            playBtn.style.background = '#F44336';
            playBtn.textContent = '📖 Playing...';
            
            playInterval = setInterval(() => {
                if (currentIndex < villageStory.length - 1) {
                    updateVillage(currentIndex + 1);
                } else {
                    pauseStory();
                }
            }, 3000); // 3 seconds per stage
        }
        
        function pauseStory() {
            isPlaying = false;
            clearInterval(playInterval);
            const playBtn = document.querySelector('.play-btn');
            playBtn.style.background = 'rgba(255,255,255,0.1)';
            playBtn.textContent = '📖 Tell Story';
        }
        
        function resetStory() {
            pauseStory();
            updateVillage(0);
        }
        
        function scrubToPosition(event) {
            const track = event.currentTarget;
            const rect = track.getBoundingClientRect();
            const percentage = (event.clientX - rect.left) / rect.width;
            const index = Math.round(percentage * (villageStory.length - 1));
            updateVillage(Math.max(0, Math.min(index, villageStory.length - 1)));
        }
        
        // Enhanced tooltip system with economic insights
        const tooltip = document.getElementById('tooltip');
        
        function initializeTooltips() {
            document.querySelectorAll('[data-title]').forEach(element => {
                element.addEventListener('mouseenter', function(e) {
                    const title = this.dataset.title;
                    const content = this.dataset.content;
                    const economic = this.dataset.economic;
                    
                    tooltip.innerHTML = `
                        <div class="tooltip-title">${title}</div>
                        <div>${content}</div>
                        ${economic ? `<div class="tooltip-economic">${economic}</div>` : ''}
                    `;
                    
                    updateTooltipPosition(e);
                    tooltip.classList.add('show');
                });
                
                element.addEventListener('mouseleave', function() {
                    tooltip.classList.remove('show');
                });
                
                element.addEventListener('mousemove', function(e) {
                    updateTooltipPosition(e);
                });
            });
        }
        
        function updateTooltipPosition(e) {
            const tooltipRect = tooltip.getBoundingClientRect();
            let left = e.clientX + 15;
            let top = e.clientY - 10;
            
            // Keep tooltip on screen
            if (left + tooltipRect.width > window.innerWidth) {
                left = e.clientX - tooltipRect.width - 15;
            }
            if (top + tooltipRect.height > window.innerHeight) {
                top = e.clientY - tooltipRect.height - 10;
            }
            
            tooltip.style.left = left + 'px';
            tooltip.style.top = top + 'px';
        }
        
        // Dynamic tooltip content based on economic stage
        function updateTooltipContent(stage) {
            // Update stall tooltips based on economic conditions
            const stall1 = document.querySelector('.stall-1');
            const stall2 = document.querySelector('.stall-2');
            const house1 = document.querySelector('.house-1');
            const house2 = document.querySelector('.house-2');
            const villager1 = document.querySelector('.villager-1');
            const villager2 = document.querySelector('.villager-2');
            
            if (stage === 'drought') {
                if (stall1) {
                    stall1.setAttribute('data-title', 'Struggling Produce Stand - Customers Can\'t Afford');
                    stall1.setAttribute('data-content', 'High inflation has priced out regular customers. The vendor struggles with rising wholesale costs and falling demand.');
                    stall1.setAttribute('data-economic', '📉 Demand destruction: High prices reduce quantity demanded, hurting both consumers and producers');
                }
                
                if (stall2) {
                    stall2.setAttribute('data-title', 'Apple Stand - Inventory Spoiling');
                    stall2.setAttribute('data-content', 'Fresh produce rots unsold as families prioritize only the most essential purchases during the inflation crisis.');
                    stall2.setAttribute('data-economic', '🍎 Income effect: As real income falls, demand for non-essential fresh foods drops first');
                }
                
                if (house1) {
                    house1.setAttribute('data-title', 'House for Sale - Mortgage Stress');
                    house1.setAttribute('data-content', 'Rising interest rates and living costs force this family to sell. They can no longer afford their mortgage payments.');
                    house1.setAttribute('data-economic', '🏠 Housing crisis: High inflation often leads to rising interest rates, making mortgages unaffordable');
                }
                
                if (house2) {
                    house2.setAttribute('data-title', 'Deferred Maintenance');
                    house2.setAttribute('data-content', 'Home improvements are postponed as all income goes to essentials. The property slowly deteriorates.');
                    house2.setAttribute('data-economic', '🔧 Investment freeze: High inflation forces households to cut capital expenditure first');
                }
                
                if (villager1) {
                    villager1.setAttribute('data-title', 'Worried Single Shopper');
                    villager1.setAttribute('data-content', 'Shopping alone with a strict list, comparing every price. The economic stress is visible in changed behavior.');
                    villager1.setAttribute('data-economic', '😰 Behavioral change: High inflation causes defensive spending and reduced social consumption');
                }
                
                if (villager2) {
                    villager2.setAttribute('data-title', 'Family Leaving Town');
                    villager2.setAttribute('data-content', 'This family cannot afford local costs anymore. They join the economic migration to areas with lower living costs.');
                    villager2.setAttribute('data-economic', '🚛 Economic migration: Inflation disparities drive population movement and regional inequality');
                }
                
            } else if (stage === 'storm') {
                if (stall1) {
                    stall1.setAttribute('data-title', 'Produce Stand - Rising Concerns');
                    stall1.setAttribute('data-content', 'Customers are starting to compare prices more carefully. The vendor notices people buying smaller quantities.');
                    stall1.setAttribute('data-economic', '👀 Price sensitivity: Rising inflation makes consumers more price-conscious and selective');
                }
                
            } else if (stage === 'recovery') {
                if (stall1) {
                    stall1.setAttribute('data-title', 'Cautious Market Recovery');
                    stall1.setAttribute('data-content', 'A few regular customers are returning, but vendors are cautious about restocking. Trust is slowly rebuilding.');
                    stall1.setAttribute('data-economic', '🌱 Recovery dynamics: Economic recovery requires rebuilding both supply capacity and consumer confidence');
                }
                
            } else {
                // Reset to original fertile state tooltips
                if (stall1) {
                    stall1.setAttribute('data-title', 'Fresh Produce Market - High Demand');
                    stall1.setAttribute('data-content', 'When inflation is stable, customers shop regularly and vendors can predict costs. Fresh produce moves quickly and profits are steady.');
                    stall1.setAttribute('data-economic', '📈 Supply & Demand: Stable prices = predictable consumer behavior = efficient markets');
                }
                
                if (house1) {
                    house1.setAttribute('data-title', 'Family Home - Mortgage Affordable');
                    house1.setAttribute('data-content', 'When inflation is low, mortgage payments are manageable relative to income. Families can invest in home improvements and feel secure about their housing costs.');
                    house1.setAttribute('data-economic', '💡 Economic insight: Low inflation = stable housing costs = confident consumer spending');
                }
            }
        }
        
        // Draggable timeline
        let isDragging = false;
        
        document.getElementById('scrubberThumb').addEventListener('mousedown', (e) => {
            isDragging = true;
            pauseStory();
            e.preventDefault();
        });
        
        document.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            
            const track = document.querySelector('.scrubber-track');
            const rect = track.getBoundingClientRect();
            const percentage = Math.max(0, Math.min(1, (e.clientX - rect.left) / rect.width));
            const index = Math.round(percentage * (villageStory.length - 1));
            updateVillage(index);
        });
        
        document.addEventListener('mouseup', () => {
            isDragging = false;
        });
        
        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            switch(e.key) {
                case 'ArrowLeft':
                    e.preventDefault();
                    if (currentIndex > 0) updateVillage(currentIndex - 1);
                    break;
                case 'ArrowRight':
                    e.preventDefault();
                    if (currentIndex < villageStory.length - 1) updateVillage(currentIndex + 1);
                    break;
                case ' ':
                    e.preventDefault();
                    isPlaying ? pauseStory() : playStory();
                    break;
                case 'Home':
                    e.preventDefault();
                    updateVillage(0);
                    break;
                case 'End':
                    e.preventDefault();
                    updateVillage(villageStory.length - 1);
                    break;
            }
        });
        
        // Initialize tooltips after DOM is loaded
        initializeTooltips();
    </script>
</body>
</html>
