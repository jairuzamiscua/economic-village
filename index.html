<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>EconoVille - Phase 1: Agrarian Economy Simulator</title>
<link rel="stylesheet" href="styles.css">
</head>
<body>

<!-- Landing Screen -->
<div id="landing" class="landing">
  <div class="landing-content">
    <h1>EconoVille: Phase 1</h1>
    <h2>Agrarian Economy (800-1500 AD)</h2>
    <p>Simulate the economic development of a pre-industrial village. Master the transition from subsistence farming to sustainable growth.</p>
    
    <div class="learn-box">
      <h3>Economic Concepts:</h3>
      <ul>
        <li><strong>Malthusian Trap</strong> - Population growth vs food supply dynamics</li>
        <li><strong>Diminishing Returns</strong> - How land scarcity constrains growth</li>
        <li><strong>Smithian Growth</strong> - Productivity gains from specialization</li>
        <li><strong>Institutional Effects</strong> - Commons vs enclosure trade-offs</li>
        <li><strong>Capital Accumulation</strong> - Tools and infrastructure investment</li>
      </ul>
    </div>
    
    <div class="button-row">
      <button class="btn-large primary" id="btnStart">Start Game</button>
      <button class="btn-large" id="btnHowTo">How To Play</button>
    </div>
    
    <div class="credits">
      <p>Built with economic development theory | <a href="https://github.com/yourusername/econoville" target="_blank">View on GitHub</a></p>
    </div>
  </div>
</div>

<!-- How To Play Modal -->
<div class="modal" id="howToModal">
  <div class="modal-content">
    <button class="modal-close" id="howToClose">√ó</button>
    <h3>How To Play</h3>
    <div class="how-to-content">
      <h4>Goal</h4>
      <p>Develop your village from subsistence farming to a thriving agrarian economy. Unlock Phase 2 by meeting all win conditions.</p>
      
      <h4>Controls</h4>
      <ul>
        <li><strong>Labor Sliders</strong> - Allocate population to farming, building, and herding</li>
        <li><strong>Work Intensity</strong> - Higher output but lowers morale</li>
        <li><strong>Drag Buildings</strong> - Drag from palette onto the map to construct</li>
        <li><strong>Click Resources</strong> - Trees and rocks provide materials</li>
        <li><strong>Crop Selection</strong> - Choose wheat (high yield), rye (hardy), or legumes (soil+)</li>
        <li><strong>Tech Tree</strong> - Unlock improvements with materials</li>
      </ul>
      
      <h4>Key Mechanics</h4>
      <ul>
        <li><strong>Real Wage</strong> - Below 1.0 = crisis, above 1.5 = prosperity</li>
        <li><strong>Soil Quality</strong> - Degrades without crop rotation</li>
        <li><strong>Event Cards</strong> - Make decisions when cards appear</li>
        <li><strong>Malthusian Cycles</strong> - Population pressure causes wage collapse, famines reset the cycle</li>
      </ul>
      
      <h4>Win Conditions</h4>
      <p>Meet all requirements to unlock Phase 2:</p>
      <ul>
        <li>Population > 150</li>
        <li>Real Wage > 1.3 for 1 full year</li>
        <li>Market infrastructure built</li>
        <li>3+ capital goods (mills/workshops)</li>
      </ul>
    </div>
  </div>
</div>

<!-- Main Game -->
<div id="gameContainer" class="shell" style="display:none">
<header>
  <div>
    <h1>EconoVille ‚Äî Phase 1: Agrarian Economy</h1>
    <div class="header-stats">
      <span>Day <span id="day">1</span> ‚Ä¢ Year <span id="year">1</span> ‚Ä¢ <span id="season">Spring</span></span>
      <button class="btn-icon" id="btnPause" title="Pause/Resume">‚è∏</button>
      <select class="speed-select" id="speedSelect">
        <option value="4000">0.5x</option>
        <option value="2000" selected>1x</option>
        <option value="1000">2x</option>
        <option value="500">4x</option>
      </select>
    </div>
  </div>
  <div class="header-buttons">
    <button class="btn" id="btnTech">Tech Tree</button>
    <button class="btn" id="btnTheory">Theory</button>
    <button class="btn" id="btnProgress">Progress</button>
    <button class="btn" id="btnExport">Export Data</button>
    <button class="btn" id="btnSave">Save</button>
    <button class="btn" id="btnReset">Reset</button>
  </div>
</header>

<div class="main">
  <!-- Left Panel -->
  <aside class="panel left">
    <h2>Labor Allocation</h2>
    <div class="labor">
      <div class="slider-row">
        <div class="slider-label">
          <span class="tooltip-trigger">Farmers<span class="tooltip-icon">?</span>
            <span class="tooltip">Work farms to produce food. More farmers = more food but fewer builders.</span>
          </span>
          <span id="farmerPct">50%</span>
        </div>
        <input type="range" min="0" max="100" value="50" id="farmerSlider"/>
      </div>
      <div class="slider-row">
        <div class="slider-label">
          <span class="tooltip-trigger">Builders<span class="tooltip-icon">?</span>
            <span class="tooltip">Construct buildings faster. Balance with food production needs.</span>
          </span>
          <span id="builderPct">30%</span>
        </div>
        <input type="range" min="0" max="100" value="30" id="builderSlider"/>
      </div>
      <div class="slider-row">
        <div class="slider-label">
          <span class="tooltip-trigger">Herders<span class="tooltip-icon">?</span>
            <span class="tooltip">Tend livestock for food and manure. Requires Livestock tech.</span>
          </span>
          <span id="herderPct">10%</span>
        </div>
        <input type="range" min="0" max="100" value="10" id="herderSlider"/>
      </div>
      <div class="slider-row">
        <div class="slider-label">
          <span class="tooltip-trigger">Work Intensity<span class="tooltip-icon">?</span>
            <span class="tooltip">Higher intensity = more output but lower morale. Based on "Industrious Revolution" theory.</span>
          </span>
          <span id="intensityPct">100%</span>
        </div>
        <input type="range" min="50" max="150" value="100" id="intensitySlider"/>
      </div>
      <div class="stat">Pop: <b id="popTotal">80</b> ‚Ä¢ Idle: <b id="idlePct">10%</b></div>
    </div>

    <h2>Crop Selection</h2>
    <div class="info-box">
      <div class="crop-select">
        <div class="crop-btn active" data-crop="wheat">
          <div class="crop-name">Wheat</div>
          <small>High yield<br>Drought risk</small>
        </div>
        <div class="crop-btn" data-crop="rye">
          <div class="crop-name">Rye</div>
          <small>Hardy<br>Lower yield</small>
        </div>
        <div class="crop-btn" data-crop="legumes">
          <div class="crop-name">Legumes</div>
          <small>Soil restore<br>Nitrogen fix</small>
        </div>
      </div>
    </div>

    <h2>Land Policy</h2>
    <div class="policy">
      <div class="stat">
        Current: <b id="landPolicy">Commons</b>
        <span class="tooltip-trigger"><span class="tooltip-icon">?</span>
          <span class="tooltip">Commons = equal access, lower efficiency. Enclosure = +15% productivity but inequality rises.</span>
        </span>
      </div>
      <button class="btn policy-btn" id="btnEnclosure">Enclose Land</button>
    </div>

    <h2>Buildings (Drag to Map)</h2>
    <div class="build-palette" id="buildPalette"></div>

    <div class="info-box">
      <h2 style="margin:0 0 8px">Land Health</h2>
      <div class="stat">Soil Quality: <b id="landQual">100%</b></div>
      <div class="stat-small">Degrades without crop rotation</div>
    </div>
  </aside>

<!-- Center Map -->
<section class="panel center">
  <div class="view">
    <div class="hud">
      <div class="badge">Pop: <span id="pop">80</span>/<span id="cap">100</span></div>
      <div class="badge" id="wagebadge">
        <span class="tooltip-trigger">Wage: <span id="realWage">1.0</span>
          <span class="tooltip">Real Wage = Food per capita / Subsistence. Below 1.0 = crisis!</span>
        </span>
      </div>
      <div class="badge" id="weatherBadge">
        <span id="weatherIcon">üå§Ô∏è</span> <span id="weatherNow">Sunny</span> ‚Üí <span id="weatherNext">Rain</span>
      </div>
      <div class="badge">Materials: <span id="mat">30</span></div>
      <div class="badge">Food: <span id="foodStock">20</span></div>
      <div class="badge">Animals: <span id="livestock">0</span></div>
    </div>
    
    <!-- Season Banner -->
    <div class="season-banner" id="seasonBanner">
      <div class="season-icon" id="seasonIcon">üå±</div>
      <div class="season-info">
        <div class="season-name" id="seasonName">Spring</div>
        <div class="season-desc" id="seasonDesc">Planting season</div>
        <div class="season-progress">
          Day <span id="seasonDay">1</span>/90
        </div>
      </div>
    </div>
    
    <div class="grid" id="grid"></div>
    <div class="ground" id="ground"></div>
  </div>
</section>

<!-- Right Panel -->
<aside class="panel right">
  <h2>Economic Indicators</h2>
  
  <div class="meter">
    <header>
      <h4 class="tooltip-trigger">Real Wage<span class="tooltip-icon">?</span>
        <span class="tooltip">Malthusian indicator: when population grows faster than food, wages fall to subsistence (1.0). Crises reset the cycle.</span>
      </h4>
      <span id="wageLbl">100%</span>
    </header>
    <div class="bar"><div class="fill" id="fillWage"></div></div>
    <div class="stat"><span id="wageStatus">Subsistence = 1.0</span></div>
  </div>

  <div class="meter">
    <header><h4>Food Security</h4><span id="foodLbl">0%</span></header>
    <div class="bar"><div class="fill" id="fillFood"></div></div>
    <div class="stat">Daily need: <span id="foodNeed">16</span></div>
    <div class="stat">Production: <span id="foodProduction">0</span>/day</div>
  </div>
  
  <div class="info-box">
    <h2 style="margin:0 0 8px">Food Buffer</h2>
    <div class="stat">
      Stored: <b id="foodDays" style="color:var(--accent)">0</b> days
    </div>
    <div class="food-buffer-bar">
      <div class="buffer-fill" id="bufferFill"></div>
      <div class="buffer-marker winter">
        <span>90d</span>
      </div>
    </div>
    <div class="stat-small" id="bufferWarning">Winter requires 90 days of stored food</div>
  </div>

  <div class="meter">
    <header><h4>Health</h4><span id="healthLbl">60%</span></header>
    <div class="bar"><div class="fill" id="fillHealth"></div></div>
    <div class="stat">Disease risk: <span id="diseaseRisk">1.0%</span></div>
  </div>

  <div class="meter">
    <header><h4>Morale</h4><span id="moraleLbl">60%</span></header>
    <div class="bar"><div class="fill" id="fillMorale"></div></div>
    <div class="stat">Affects productivity ¬±10%</div>
  </div>

  <div class="info-box">
    <h2 style="margin:0 0 8px">Theory Active</h2>
    <div class="stat" id="theoryStatus">Malthusian Trap</div>
  </div>

  <div class="info-box">
    <h2 style="margin:0 0 8px">Game Log</h2>
    <div class="stat" id="gameLog">Time will start when you interact...</div>
  </div>
</aside>

<!-- Event Card -->
<div class="event-card" id="eventCard">
  <div class="event-content">
    <h3 id="eventTitle">Event</h3>
    <p id="eventDesc">Description</p>
    <div class="event-effect" id="eventEffect"></div>
    <div class="event-buttons">
      <button class="btn primary" id="eventAccept">Accept</button>
      <button class="btn" id="eventDecline">Decline</button>
    </div>
  </div>
</div>

<!-- Tech Tree Modal -->
<div class="modal" id="techModal">
  <div class="modal-content large">
    <button class="modal-close" id="techClose">√ó</button>
    <h3>Technology Tree - Agrarian Phase</h3>
    <div class="tech-grid" id="techGrid"></div>
  </div>
</div>

<!-- Theory Modal -->
<div class="modal" id="theoryModal">
  <div class="modal-content">
    <button class="modal-close" id="theoryClose">√ó</button>
    <h3>Economic Theory Explained</h3>
    <div class="theory-content">
      <div class="theory-section">
        <h4>Malthusian Trap</h4>
        <p>Thomas Malthus (1798) observed that population grows geometrically while food supply grows arithmetically. Result: wages fall to subsistence, checking population growth through "positive checks" (famine, disease).</p>
        <p><strong>In-game:</strong> Watch Real Wage. When it falls below 1.0, you're in crisis. Famines kill population, temporarily raising wages for survivors.</p>
      </div>

      <div class="theory-section">
        <h4>Diminishing Returns to Land</h4>
        <p>David Ricardo's core insight: as more farmers work fixed land, marginal productivity falls. Each additional farm produces less than the previous one.</p>
        <p><strong>In-game:</strong> First farm produces lots of food. Tenth farm produces much less per farmer. Land quality also degrades without rotation.</p>
      </div>

      <div class="theory-section">
        <h4>Smithian Growth</h4>
        <p>Adam Smith (1776): productivity gains from division of labor and specialization. "Extent of market" determines how much specialization is possible.</p>
        <p><strong>In-game:</strong> Tech upgrades (Tools, Heavy Plough, Seed Selection) represent TFP growth. Market Road enables surplus trade.</p>
      </div>

      <div class="theory-section">
        <h4>Enclosure Movement</h4>
        <p>Historical shift from common land to private ownership. Increased agricultural efficiency but displaced peasants, creating inequality.</p>
        <p><strong>In-game:</strong> Enclosure gives +15% food but drops morale. Commons are egalitarian but less efficient.</p>
      </div>

      <div class="theory-section">
        <h4>Industrious Revolution</h4>
        <p>Jan de Vries: pre-industrial families worked harder (not smarter) to afford new market goods. Labor intensity increased before productivity.</p>
        <p><strong>In-game:</strong> Work Intensity slider. Higher = more output but morale penalty. Represents working longer hours.</p>
      </div>

      <div class="theory-section">
        <h4>Capital Accumulation</h4>
        <p>Tools, mills, infrastructure = capital goods that boost productivity. But they depreciate and require maintenance.</p>
        <p><strong>In-game:</strong> Windmills add +12% TFP but can break down. Represents capital deepening in pre-industrial economy.</p>
      </div>
    </div>
  </div>
</div>

<!-- Progress Modal -->
<div class="modal" id="progressModal">
  <div class="modal-content">
    <button class="modal-close" id="progressClose">√ó</button>
    <h3>Phase 2 Unlock Progress</h3>
    <div class="progress-content">
      <div class="progress-bar-container">
        <div class="progress-bar-fill" id="progressFill"></div>
        <span class="progress-percent" id="progressPercent">0%</span>
      </div>
      
      <h4>Requirements:</h4>
      <ul class="requirements-list">
        <li id="req1"><span class="req-icon">‚óã</span> Population > 150</li>
        <li id="req2"><span class="req-icon">‚óã</span> Real Wage > 1.3 for 1 year</li>
        <li id="req3"><span class="req-icon">‚óã</span> Market infrastructure built</li>
        <li id="req4"><span class="req-icon">‚óã</span> 3+ capital goods (mills)</li>
      </ul>

      <div class="stats-summary">
        <h4>Current Stats:</h4>
        <p>Population: <span id="statPop">80</span> / 150</p>
        <p>Real Wage: <span id="statWage">1.0</span> (sustained: <span id="statWageYears">0</span> years)</p>
        <p>Market: <span id="statMarket">Not built</span></p>
        <p>Capital Goods: <span id="statCapital">0</span> / 3</p>
      </div>
    </div>
  </div>
</div>

<!-- Victory Modal -->
<div class="modal" id="victoryModal">
  <div class="modal-content">
    <h3>üéâ Agrarian Phase Complete!</h3>
    <div class="victory-content">
      <p>Your village has successfully transitioned from subsistence farming to a thriving agrarian economy!</p>
      
      <div class="victory-stats">
        <h4>Final Statistics:</h4>
        <p>Time: <span id="vicYears">0</span> years, <span id="vicDays">0</span> days</p>
        <p>Final Population: <span id="vicPop">0</span></p>
        <p>Total Deaths: <span id="vicDeaths">0</span></p>
        <p>Efficiency Grade: <span id="vicGrade">B+</span></p>
      </div>

      <div class="phase2-teaser">
        <h4>Phase 2: Early Industry</h4>
        <p>Coming soon: Introduce coin economy, specialized craftsmen, proto-factories, and urban-rural dynamics.</p>
      </div>

      <div class="button-row">
        <button class="btn primary" id="btnPlayAgain">Play Again</button>
        <button class="btn" id="btnExportVictory">Export Data</button>
      </div>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script src="game.js"></script>
</body>
</html>